# Ingest å±‚ä½¿ç”¨æŒ‡å—

## ğŸ¯ ä»€ä¹ˆæ˜¯ Ingest å±‚ï¼Ÿ

Ingest å±‚æ˜¯ AutoCut Director çš„**ç´ æé¢„å¤„ç†å±‚**ï¼Œè´Ÿè´£ï¼š

1. **éŸ³é¢‘æå–** - ä»è§†é¢‘æå–éŸ³é¢‘ï¼ˆffmpegï¼‰
2. **åœºæ™¯åˆ‡ç‚¹æ£€æµ‹** - æç¤ºç”¨æˆ·åœ¨ Resolve ä¸­åšåœºæ™¯æ£€æµ‹
3. **æ–‡ä»¶ç®¡ç†** - ç»Ÿä¸€ç®¡ç† job ç›®å½•ç»“æ„

---

## ğŸ“ Job ç›®å½•ç»“æ„

æ¯ä¸ª job éƒ½æœ‰ç‹¬ç«‹çš„ç›®å½•ç»“æ„ï¼š

```
jobs/
â””â”€â”€ job_20250205_143022/          # Job ç›®å½•
    â”œâ”€â”€ input/                     # è¾“å…¥æ–‡ä»¶
    â”‚   â”œâ”€â”€ video.mp4             # åŸå§‹è§†é¢‘
    â”‚   â””â”€â”€ timeline.edl          # EDL æ–‡ä»¶ï¼ˆç”¨æˆ·å¯¼å‡ºï¼‰
    â”œâ”€â”€ temp/                      # ä¸´æ—¶æ–‡ä»¶
    â”‚   â””â”€â”€ video.wav             # æå–çš„éŸ³é¢‘
    â””â”€â”€ output/                    # è¾“å‡ºæ–‡ä»¶
        â”œâ”€â”€ scenes.json           # åœºæ™¯æ•°æ®
        â”œâ”€â”€ transcript.json       # è½¬å½•æ•°æ®
        â”œâ”€â”€ editing_dsl.json      # å‰ªè¾‘è„šæœ¬
        â””â”€â”€ final.mp4             # æœ€ç»ˆæˆç‰‡
```

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### æ–¹å¼ 1: å‘½ä»¤è¡Œå·¥å…·

```bash
cd autocut-director
python -m app.tools.media_ingest input.mp4 job_001
```

**è¾“å‡º**:
- åˆ›å»º `jobs/job_001/` ç›®å½•
- æå–éŸ³é¢‘åˆ° `jobs/job_001/temp/input.wav`
- æ˜¾ç¤ºåœºæ™¯åˆ‡ç‚¹æ£€æµ‹æŒ‡å¼•

---

### æ–¹å¼ 2: Python API

```python
from app.tools.media_ingest import MediaIngest

# åˆ›å»º Ingest ç®¡ç†å™¨
ingest = MediaIngest(job_dir="jobs")

# å®Œæ•´ Ingest æµç¨‹
result = ingest.ingest_video(
    video_path="D:/Footage/input.mp4",
    job_id="job_001",
    extract_audio=True,
    wait_for_scene_detection=False
)

print(f"Job ç›®å½•: {result['job_path']}")
print(f"éŸ³é¢‘æ–‡ä»¶: {result['audio_path']}")
```

---

### æ–¹å¼ 3: FastAPI æ¥å£

#### 3.1 å®Œæ•´ Ingestï¼ˆä¸€æ­¥åˆ°ä½ï¼‰

```bash
curl -X POST http://localhost:8000/api/ingest/ \
  -F "video=@input.mp4" \
  -F "extract_audio=true"
```

**è¿”å›**:
```json
{
  "job_id": "job_20250205_143022",
  "job_path": "jobs/job_20250205_143022",
  "video_path": "jobs/job_20250205_143022/input/input.mp4",
  "audio_path": "jobs/job_20250205_143022/temp/input.wav",
  "scene_detection_info": {
    "video_path": "...",
    "instructions": "è¯·åœ¨ Resolve ä¸­å®Œæˆåœºæ™¯åˆ‡ç‚¹æ£€æµ‹å¹¶å¯¼å‡º EDL/XML",
    "export_formats": ["EDL (CMX 3600)", "Final Cut Pro XML"],
    "recommended": "EDL"
  },
  "edl_save_path": "jobs/job_20250205_143022/input",
  "message": "Ingest å®Œæˆï¼Œè¯·åœ¨ Resolve ä¸­å®Œæˆåœºæ™¯åˆ‡ç‚¹æ£€æµ‹å¹¶ä¸Šä¼  EDL"
}
```

#### 3.2 åˆ†æ­¥æ“ä½œ

**æ­¥éª¤ 1: ä¸Šä¼ è§†é¢‘**
```bash
curl -X POST http://localhost:8000/api/ingest/upload \
  -F "video=@input.mp4"
```

**æ­¥éª¤ 2: æå–éŸ³é¢‘**
```bash
curl -X POST http://localhost:8000/api/ingest/extract-audio \
  -F "job_id=job_20250205_143022"
```

**æ­¥éª¤ 3: è·å–åœºæ™¯åˆ‡ç‚¹æ£€æµ‹æŒ‡å¼•**
```bash
curl -X POST http://localhost:8000/api/ingest/scene-detection-info \
  -F "job_id=job_20250205_143022"
```

**æ­¥éª¤ 4: ä¸Šä¼  EDL**
```bash
curl -X POST http://localhost:8000/api/ingest/upload-edl \
  -F "job_id=job_20250205_143022" \
  -F "edl_file=@timeline.edl"
```

---

### æ–¹å¼ 4: é›†æˆåˆ° quick_start.py

`quick_start.py` å·²è‡ªåŠ¨é›†æˆ Ingest å±‚ï¼š

```bash
cd autocut-director
python quick_start.py
```

**æµç¨‹**:
1. è¾“å…¥è§†é¢‘è·¯å¾„
2. è‡ªåŠ¨åˆ›å»º job ç›®å½•
3. è‡ªåŠ¨æå–éŸ³é¢‘
4. æ˜¾ç¤ºåœºæ™¯åˆ‡ç‚¹æ£€æµ‹æŒ‡å¼•
5. ç­‰å¾…ç”¨æˆ·å¯¼å‡º EDL
6. ç»§ç»­æ‰§è¡Œå®Œæ•´æµæ°´çº¿

---

## ğŸ¬ åœºæ™¯åˆ‡ç‚¹æ£€æµ‹æ­¥éª¤

### åœ¨ DaVinci Resolve ä¸­æ“ä½œï¼š

1. **æ‰“å¼€é¡¹ç›®**
   - å¯åŠ¨ DaVinci Resolve
   - æ‰“å¼€æˆ–åˆ›å»ºé¡¹ç›®

2. **å¯¼å…¥è§†é¢‘**
   - å°†è§†é¢‘æ–‡ä»¶æ‹–å…¥åª’ä½“æ± 
   - æˆ–ä½¿ç”¨ File â†’ Import â†’ Media

3. **åœºæ™¯åˆ‡ç‚¹æ£€æµ‹**
   - å³é”®è§†é¢‘ â†’ **Scene Cut Detection**
   - è°ƒæ•´æ£€æµ‹å‚æ•°ï¼ˆå»ºè®®ä½¿ç”¨é»˜è®¤å€¼ï¼‰
   - ç‚¹å‡» **Detect Scenes** å¼€å§‹æ£€æµ‹

4. **åˆ›å»ºæ—¶é—´çº¿**
   - æ£€æµ‹å®Œæˆåï¼Œå°†è§†é¢‘æ‹–åˆ°æ—¶é—´çº¿
   - åœºæ™¯åˆ‡ç‚¹ä¼šè‡ªåŠ¨åº”ç”¨

5. **å¯¼å‡º EDL**
   - File â†’ Export â†’ Timeline â†’ **EDL**
   - é€‰æ‹© **CMX 3600** æ ¼å¼
   - ä¿å­˜åˆ° job ç›®å½•çš„ `input/` æ–‡ä»¶å¤¹

**æˆ–å¯¼å‡º XML**:
   - File â†’ Export â†’ Timeline â†’ **Final Cut Pro XML**
   - ä¿å­˜åˆ° job ç›®å½•çš„ `input/` æ–‡ä»¶å¤¹

---

## ğŸ”§ é…ç½®é€‰é¡¹

### éŸ³é¢‘æå–å‚æ•°

```python
ingest.extract_audio(
    video_path="input.mp4",
    output_path="output.wav",
    format="wav",          # wav/mp3/aac
    sample_rate=16000      # é‡‡æ ·ç‡ï¼ˆHzï¼‰
)
```

**æ¨èé…ç½®**:
- **format**: `wav` - Whisper æ¨èæ ¼å¼
- **sample_rate**: `16000` - Whisper æ¨èé‡‡æ ·ç‡

---

## ğŸ“Š å®Œæ•´æµç¨‹å›¾

```
input.mp4
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ 0: Ingest - ç´ æé¢„å¤„ç†                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. åˆ›å»º job ç›®å½•                                             â”‚
â”‚    jobs/job_xxx/                                            â”‚
â”‚    â”œâ”€â”€ input/                                               â”‚
â”‚    â”œâ”€â”€ temp/                                                â”‚
â”‚    â””â”€â”€ output/                                              â”‚
â”‚                                                              â”‚
â”‚ 2. æå–éŸ³é¢‘ï¼ˆffmpegï¼‰                                        â”‚
â”‚    input.mp4 â†’ temp/input.wav                               â”‚
â”‚                                                              â”‚
â”‚ 3. æç¤ºåœºæ™¯åˆ‡ç‚¹æ£€æµ‹                                          â”‚
â”‚    â†’ ç”¨æˆ·åœ¨ Resolve ä¸­æ“ä½œ                                   â”‚
â”‚    â†’ å¯¼å‡º EDL/XML åˆ° input/                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    input/timeline.edl + temp/input.wav
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ 1: åˆ†æç´ æï¼ˆæœ¬åœ°ï¼‰                                     â”‚
â”‚ EDL â†’ scenes.json                                           â”‚
â”‚ Audio â†’ transcript.json                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ 2: AI ç”Ÿæˆï¼ˆè¿œç¨‹ï¼‰                                      â”‚
â”‚ scenes + transcript â†’ editing_dsl.json                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ 3: Resolve æ‰§è¡Œï¼ˆæœ¬åœ°ï¼‰                                 â”‚
â”‚ DSL â†’ Actions â†’ æˆç‰‡                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    output/final.mp4
```

---

## ğŸ§ª æµ‹è¯•

```bash
cd autocut-director
python test_ingest.py
```

**æµ‹è¯•å†…å®¹**:
- âœ… Job ç›®å½•åˆ›å»º
- âœ… éŸ³é¢‘æå–ï¼ˆéœ€è¦ ffmpegï¼‰
- âœ… åœºæ™¯åˆ‡ç‚¹æ£€æµ‹æç¤º
- âœ… å®Œæ•´ Ingest æµç¨‹

---

## ğŸ” ä¾èµ–

### ffmpeg

**å®‰è£…**:

**Windows**:
```bash
# ä½¿ç”¨ Chocolatey
choco install ffmpeg

# æˆ–æ‰‹åŠ¨ä¸‹è½½
# https://ffmpeg.org/download.html
```

**éªŒè¯**:
```bash
ffmpeg -version
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. Job å‘½åè§„èŒƒ

```python
# ä½¿ç”¨æ—¶é—´æˆ³
job_id = f"job_{datetime.now().strftime('%Y%m%d_%H%M%S')}"

# æˆ–ä½¿ç”¨é¡¹ç›®åç§°
job_id = f"project_name_{timestamp}"
```

### 2. éŸ³é¢‘æ ¼å¼é€‰æ‹©

- **WAV** - æ¨èï¼ŒWhisper åŸç”Ÿæ”¯æŒ
- **MP3** - æ–‡ä»¶æ›´å°ï¼Œä½†éœ€è¦è§£ç 
- **AAC** - é«˜è´¨é‡ï¼Œæ–‡ä»¶é€‚ä¸­

### 3. åœºæ™¯åˆ‡ç‚¹æ£€æµ‹å‚æ•°

åœ¨ Resolve ä¸­ï¼š
- **Sensitivity**: Mediumï¼ˆä¸­ç­‰çµæ•åº¦ï¼‰
- **Minimum Scene Duration**: 1 ç§’
- **é€‚ç”¨åœºæ™¯**: å¤§éƒ¨åˆ†è§†é¢‘

### 4. EDL vs XML

| æ ¼å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|
| EDL | ç®€å•ã€è§£æå¿« | ä¿¡æ¯æœ‰é™ |
| XML | ä¿¡æ¯å®Œæ•´ | æ–‡ä»¶å¤§ã€è§£ææ…¢ |

**æ¨è**: ä½¿ç”¨ **EDL (CMX 3600)** æ ¼å¼

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: ffmpeg æœªå®‰è£…

```
âŒ ffmpeg æœªå®‰è£…
```

**è§£å†³**:
```bash
# Windows
choco install ffmpeg

# æˆ–æ‰‹åŠ¨ä¸‹è½½å¹¶æ·»åŠ åˆ° PATH
```

### é—®é¢˜ 2: éŸ³é¢‘æå–å¤±è´¥

```
âŒ ffmpeg æ‰§è¡Œå¤±è´¥
```

**æ£€æŸ¥**:
1. è§†é¢‘æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. è§†é¢‘æ–‡ä»¶æ˜¯å¦æŸå
3. è¾“å‡ºè·¯å¾„æ˜¯å¦å¯å†™

### é—®é¢˜ 3: EDL æ–‡ä»¶æœªæ‰¾åˆ°

```
âŒ æœªæ‰¾åˆ° EDL/XML æ–‡ä»¶
```

**è§£å†³**:
1. ç¡®è®¤å·²åœ¨ Resolve ä¸­å¯¼å‡º EDL
2. ç¡®è®¤æ–‡ä»¶ä¿å­˜åˆ°æ­£ç¡®çš„ `input/` ç›®å½•
3. ç¡®è®¤æ–‡ä»¶æ‰©å±•åä¸º `.edl` æˆ– `.xml`

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [PIPELINE_GUIDE.md](PIPELINE_GUIDE.md) - å®Œæ•´æµæ°´çº¿æŒ‡å—
- [CORE_LOGIC.md](CORE_LOGIC.md) - æ ¸å¿ƒé€»è¾‘è¯´æ˜
- [API_USAGE.md](API_USAGE.md) - API ä½¿ç”¨æŒ‡å—

---

## ğŸ‰ æ€»ç»“

Ingest å±‚è®© AutoCut Director çš„æµç¨‹æ›´å®Œæ•´ï¼š

**ä¹‹å‰**:
```
ç´ æ â†’ åˆ†æ â†’ AI â†’ æ‰§è¡Œ â†’ æˆç‰‡
```

**ç°åœ¨**:
```
ç´ æ â†’ Ingest â†’ åˆ†æ â†’ AI â†’ æ‰§è¡Œ â†’ æˆç‰‡
       â†‘
    éŸ³é¢‘æå– + åœºæ™¯æ£€æµ‹æç¤º + æ–‡ä»¶ç®¡ç†
```

**æ ¸å¿ƒä¼˜åŠ¿**:
- âœ… è‡ªåŠ¨æå–éŸ³é¢‘ï¼ˆæ— éœ€æ‰‹åŠ¨æ“ä½œï¼‰
- âœ… ç»Ÿä¸€ job ç›®å½•ç®¡ç†
- âœ… æ¸…æ™°çš„åœºæ™¯åˆ‡ç‚¹æ£€æµ‹æŒ‡å¼•
- âœ… å®Œæ•´çš„æ–‡ä»¶è¿½è¸ª

**ç«‹å³å¼€å§‹**: `python quick_start.py`
