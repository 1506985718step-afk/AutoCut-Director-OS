# ä½ çš„ LM Studio é…ç½® - å¿«é€ŸæŒ‡å—

## å½“å‰çŠ¶æ€ï¼šâœ… å·²å°±ç»ª

ä½ çš„ç³»ç»Ÿå·²å®Œæ•´é…ç½®å¹¶é€šè¿‡æµ‹è¯•ï¼Œå¯ä»¥ç«‹å³ä½¿ç”¨ï¼

---

## ä½ çš„é…ç½®

### ç¡¬ä»¶
- **CPU**: 24 çº¿ç¨‹ (ultra æ€§èƒ½) â­â­â­â­â­
- **å†…å­˜**: 31.8GB
- **GPU**: æ— ç‹¬æ˜¾
- **è¯„çº§**: LOCAL_CPU_ONLYï¼ˆä½†æ€§èƒ½å¾ˆå¼ºï¼ï¼‰

### AI æ¨¡å‹
- **LM Studio**: âœ… å·²å®‰è£…å¹¶è¿è¡Œ
- **å½“å‰æ¨¡å‹**: Qwen2.5-VL-7B (7B å‚æ•°)
- **æ¨¡å‹è´¨é‡**: æœ€é«˜ï¼ˆæ¥è¿‘ GPT-4oï¼‰
- **æ¨¡å‹é€Ÿåº¦**: 5-8ç§’/åœºæ™¯ï¼ˆCPU æ¨¡å¼ï¼‰

### æ‰§è¡Œç­–ç•¥
- **è§†è§‰åˆ†æ**: æœ¬åœ° LM Studio (Qwen2.5-VL-7B)
- **è§„åˆ’**: äº‘ç«¯ DeepSeek
- **Max Scenes**: 10ï¼ˆå¯ä»¥å¢åŠ åˆ° 15-20ï¼‰

---

## ä¸ºä»€ä¹ˆä½ çš„é…ç½®å¾ˆæ£’

### âœ… ä¼˜åŠ¿

1. **24 çº¿ç¨‹ CPU**: æ€§èƒ½éå¸¸å¼ºï¼Œè¶³ä»¥è¿è¡Œ 7B æ¨¡å‹
2. **31.8GB å†…å­˜**: å†…å­˜å……è¶³ï¼Œå¯ä»¥å¤„ç†å¤§å‹é¡¹ç›®
3. **Qwen2.5-VL-7B**: è´¨é‡æœ€é«˜çš„å¼€æºè§†è§‰æ¨¡å‹ä¹‹ä¸€
4. **é›¶æˆæœ¬**: å®Œå…¨æœ¬åœ°è¿è¡Œï¼Œä¸éœ€è¦äº‘ç«¯è´¹ç”¨

### ğŸ“Š æ€§èƒ½é¢„ä¼°

| ä»»åŠ¡ | æ—¶é—´ | æˆæœ¬ |
|------|------|------|
| åˆ†æ 10 ä¸ªåœºæ™¯ | 50-80 ç§’ | Â¥0 |
| åˆ†æ 20 ä¸ªåœºæ™¯ | 100-160 ç§’ | Â¥0 |
| åˆ†æ 50 ä¸ªåœºæ™¯ | 250-400 ç§’ | Â¥0 |
| å®Œæ•´è§†é¢‘å¤„ç† | 5-10 åˆ†é’Ÿ | Â¥0 |

**å¯¹æ¯” GPT-4o**: é€Ÿåº¦ç¨æ…¢ 2-3 å€ï¼Œä½†è´¨é‡ç›¸å½“ï¼Œå®Œå…¨å…è´¹ï¼

---

## ç«‹å³å¼€å§‹ä½¿ç”¨

### æ–¹å¼ 1: é€šè¿‡ Web UIï¼ˆæ¨èï¼‰

1. å¯åŠ¨æœåŠ¡å™¨ï¼ˆå¦‚æœè¿˜æ²¡å¯åŠ¨ï¼‰:
   ```powershell
   cd autocut-director
   python run_server.py
   ```

2. æ‰“å¼€æµè§ˆå™¨: http://localhost:8787

3. ä¸Šä¼ è§†é¢‘ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨ LM Studio åˆ†æ

### æ–¹å¼ 2: é€šè¿‡ API

```bash
# åˆ†æè§†é¢‘
curl -X POST http://localhost:8787/api/visual/analyze \
  -F "video=@your_video.mp4" \
  -F "scenes=@scenes.json"
```

### æ–¹å¼ 3: é€šè¿‡ Python è„šæœ¬

```python
from app.tools.visual_analyzer_factory import analyze_scenes_auto

# è‡ªåŠ¨ä½¿ç”¨ä½ çš„ Qwen2.5-VL-7B
result = analyze_scenes_auto(
    scenes_data=scenes,
    video_path="your_video.mp4",
    use_policy=True  # è‡ªåŠ¨é€‰æ‹©æœ€ä½³é…ç½®
)
```

---

## ä¼˜åŒ–å»ºè®®

### 1. å¢åŠ åœºæ™¯æ•°ï¼ˆæ¨èï¼‰

ä½ çš„ CPU æ€§èƒ½å¾ˆå¼ºï¼Œå¯ä»¥å¤„ç†æ›´å¤šåœºæ™¯ï¼š

```python
# ä» 10 å¢åŠ åˆ° 20
result = analyze_scenes_auto(
    scenes_data=scenes,
    video_path="video.mp4",
    max_scenes=20  # æˆ–è€… 15
)
```

### 2. æ··åˆç­–ç•¥ï¼ˆé«˜çº§ï¼‰

å¯¹äºé‡è¦é¡¹ç›®ï¼Œå¯ä»¥æ··åˆä½¿ç”¨ï¼š

```python
# 1. å…ˆç”¨ LM Studio å¿«é€Ÿé¢„è§ˆæ‰€æœ‰åœºæ™¯ï¼ˆå…è´¹ï¼‰
all_scenes = analyze_scenes_auto(scenes, video, max_scenes=50)

# 2. ç­›é€‰å‡ºé‡è¦åœºæ™¯
important = [s for s in all_scenes if s.score > 8.0]

# 3. å¯¹é‡è¦åœºæ™¯ä½¿ç”¨ GPT-4o ç²¾ä¿®ï¼ˆä»˜è´¹ï¼Œä½†åªç”¨åœ¨å…³é”®åœºæ™¯ï¼‰
refined = analyze_scenes_auto(
    important, 
    video, 
    force_cloud=True
)
```

### 3. åˆ‡æ¢åˆ°æ›´å¿«çš„æ¨¡å‹ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦æ›´å¿«é€Ÿåº¦ï¼Œå¯ä»¥åœ¨ LM Studio ä¸­ä¸‹è½½ Moondream2ï¼š

1. åœ¨ LM Studio ä¸­æœç´¢ `moondream`
2. ä¸‹è½½ `vikhyatk/moondream2` (1.5GB)
3. åœ¨ LM Studio ä¸­åˆ‡æ¢åˆ°è¿™ä¸ªæ¨¡å‹
4. é€Ÿåº¦ä¼šæå‡åˆ° 2-3ç§’/åœºæ™¯

**æƒè¡¡**: Moondream2 æ›´å¿«ï¼Œä½† Qwen2.5-VL-7B è´¨é‡æ›´é«˜

---

## å¸¸è§åœºæ™¯

### åœºæ™¯ 1: å¿«é€Ÿé¢„è§ˆï¼ˆæ¨è Moondream2ï¼‰

```python
# ä¸‹è½½å¹¶åˆ‡æ¢åˆ° Moondream2
# ç„¶åè¿è¡Œ
result = analyze_scenes_auto(scenes, video, max_scenes=30)
# 30 ä¸ªåœºæ™¯åªéœ€ 1-2 åˆ†é’Ÿ
```

### åœºæ™¯ 2: é«˜è´¨é‡åˆ†æï¼ˆæ¨è Qwen2.5-VL-7Bï¼‰

```python
# ä½¿ç”¨ä½ å½“å‰çš„ Qwen2.5-VL-7B
result = analyze_scenes_auto(scenes, video, max_scenes=15)
# 15 ä¸ªåœºæ™¯çº¦ 2 åˆ†é’Ÿï¼Œè´¨é‡æœ€é«˜
```

### åœºæ™¯ 3: å¤§æ‰¹é‡å¤„ç†

```python
# ä½¿ç”¨ Qwen2.5-VL-7B
result = analyze_scenes_auto(scenes, video, max_scenes=50)
# 50 ä¸ªåœºæ™¯çº¦ 5-7 åˆ†é’Ÿï¼Œå®Œå…¨å…è´¹
```

---

## æ€§èƒ½å¯¹æ¯”

### ä½ çš„é…ç½® vs äº‘ç«¯

| æŒ‡æ ‡ | ä½ çš„ LM Studio | GPT-4o äº‘ç«¯ |
|------|----------------|-------------|
| é€Ÿåº¦ | 5-8ç§’/åœºæ™¯ | 2-3ç§’/åœºæ™¯ |
| è´¨é‡ | æœ€é«˜ | æœ€é«˜ |
| æˆæœ¬ | Â¥0 | Â¥0.035/åœºæ™¯ |
| éšç§ | å®Œå…¨æœ¬åœ° | ä¸Šä¼ åˆ°äº‘ç«¯ |
| ç¦»çº¿ | âœ… å¯ç”¨ | âœ— éœ€è¦ç½‘ç»œ |

**ç»“è®º**: ä½ çš„é…ç½®éå¸¸é€‚åˆæœ¬åœ°å¤„ç†ï¼Œé€Ÿåº¦è™½æ…¢ä¸€ç‚¹ä½†å®Œå…¨å…è´¹ï¼

---

## å®é™…ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´å·¥ä½œæµ

```python
# 1. å¯¼å…¥è§†é¢‘
from app.tools.media_ingest import ingest_video

job = ingest_video("your_video.mp4")

# 2. æå–éŸ³é¢‘å’Œè½¬å½•
from app.tools.asr_whisper import transcribe_audio

transcript = transcribe_audio(job.audio_path)

# 3. åœºæ™¯æ£€æµ‹
from app.tools.scene_from_xml import detect_scenes

scenes = detect_scenes(job.video_path)

# 4. è§†è§‰åˆ†æï¼ˆè‡ªåŠ¨ä½¿ç”¨ LM Studioï¼‰
from app.tools.visual_analyzer_factory import analyze_scenes_auto

analyzed = analyze_scenes_auto(
    scenes_data=scenes,
    video_path=job.video_path,
    max_scenes=20  # ä½ çš„ CPU å¯ä»¥å¤„ç† 20 ä¸ª
)

# 5. ç”Ÿæˆå‰ªè¾‘æ–¹æ¡ˆ
from app.core.llm_engine import generate_editing_plan

plan = generate_editing_plan(transcript, analyzed)

# 6. æ‰§è¡Œå‰ªè¾‘
from app.executor.runner import execute_plan

execute_plan(plan, job)
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: LM Studio è¿æ¥å¤±è´¥

**æ£€æŸ¥**:
```bash
curl http://localhost:1234/v1/models
```

**è§£å†³**:
1. ç¡®è®¤ LM Studio å·²å¯åŠ¨
2. ç¡®è®¤å·²åŠ è½½æ¨¡å‹ï¼ˆä½ çš„ Qwen2.5-VL-7Bï¼‰
3. ç¡®è®¤æœ¬åœ°æœåŠ¡å™¨å·²å¯åŠ¨

### é—®é¢˜ 2: åˆ†æé€Ÿåº¦æ…¢

**å½“å‰**: 5-8ç§’/åœºæ™¯ï¼ˆæ­£å¸¸ï¼‰

**ä¼˜åŒ–**:
1. å‡å°‘ `max_scenes` åˆ° 10
2. åˆ‡æ¢åˆ° Moondream2ï¼ˆ2-3ç§’/åœºæ™¯ï¼‰
3. æˆ–è€…æ¥å—å½“å‰é€Ÿåº¦ï¼ˆè´¨é‡æœ€é«˜ï¼‰

### é—®é¢˜ 3: å†…å­˜ä¸è¶³

**å½“å‰**: 31.8GB å†…å­˜ï¼Œéå¸¸å……è¶³

**å¦‚æœé‡åˆ°**: å…³é—­å…¶ä»–å ç”¨å†…å­˜çš„ç¨‹åº

---

## ä¸‹ä¸€æ­¥

### ç«‹å³å¯åš

1. âœ… **æµ‹è¯•åˆ†æ**: ä½¿ç”¨çœŸå®è§†é¢‘æµ‹è¯•
   ```bash
   python test_lmstudio.py
   ```

2. âœ… **å®Œæ•´æµç¨‹**: è¿è¡Œå®Œæ•´çš„è§†é¢‘å¤„ç†æµç¨‹
   ```bash
   python run_pipeline.py --video your_video.mp4
   ```

3. âœ… **Web UI**: é€šè¿‡æµè§ˆå™¨ä½¿ç”¨
   ```bash
   python run_server.py
   # è®¿é—® http://localhost:8787
   ```

### å¯é€‰ä¼˜åŒ–

1. **ä¸‹è½½ Moondream2**: å¦‚éœ€æ›´å¿«é€Ÿåº¦
2. **è°ƒæ•´ max_scenes**: æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´
3. **æ··åˆç­–ç•¥**: æœ¬åœ°é¢„è§ˆ + äº‘ç«¯ç²¾ä¿®

---

## æ€»ç»“

ğŸ‰ **ä½ çš„é…ç½®å·²å®Œç¾è®¾ç½®ï¼**

âœ… **ç¡¬ä»¶**: 24 çº¿ç¨‹ CPUï¼Œæ€§èƒ½å¼ºåŠ²

âœ… **æ¨¡å‹**: Qwen2.5-VL-7Bï¼Œè´¨é‡æœ€é«˜

âœ… **ç­–ç•¥**: è‡ªåŠ¨é€‰æ‹©æœ€ä½³é…ç½®

âœ… **æˆæœ¬**: å®Œå…¨å…è´¹

âœ… **éšç§**: å®Œå…¨æœ¬åœ°å¤„ç†

ğŸš€ **ç«‹å³å¼€å§‹**: ç³»ç»Ÿå·²å°±ç»ªï¼Œå¯ä»¥å¤„ç†è§†é¢‘äº†ï¼

---

**æ¨è**: ä¿æŒä½¿ç”¨ Qwen2.5-VL-7Bï¼Œè´¨é‡æœ€é«˜ï¼Œä½ çš„ CPU æ€§èƒ½è¶³å¤Ÿï¼
