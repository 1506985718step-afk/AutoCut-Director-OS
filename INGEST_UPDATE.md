# Ingest å±‚æ›´æ–°æ€»ç»“

## ğŸ¯ æ›´æ–°å†…å®¹

ä¸º AutoCut Director æ·»åŠ äº† **Ingest å±‚**ï¼ˆç´ æé¢„å¤„ç†å±‚ï¼‰ï¼Œå®Œå–„äº†ä»ç´ æåˆ°æˆç‰‡çš„å®Œæ•´é—­ç¯ã€‚

---

## âœ¨ æ–°å¢åŠŸèƒ½

### 1. åª’ä½“ç´ æ Ingest å·¥å…·

**æ–‡ä»¶**: `app/tools/media_ingest.py`

**åŠŸèƒ½**:
- âœ… åˆ›å»º job ç›®å½•ç»“æ„
- âœ… ä»è§†é¢‘æå–éŸ³é¢‘ï¼ˆffmpegï¼‰
- âœ… åœºæ™¯åˆ‡ç‚¹æ£€æµ‹æç¤º
- âœ… ç­‰å¾… EDL/XML æ–‡ä»¶
- âœ… ç»Ÿä¸€æ–‡ä»¶ç®¡ç†

**æ ¸å¿ƒç±»**:
```python
class MediaIngest:
    def create_job(job_id) -> Path
    def extract_audio(video_path, ...) -> str
    def prompt_scene_detection(video_path) -> Dict
    def wait_for_edl(job_path, timeout) -> Optional[Path]
    def ingest_video(video_path, job_id, ...) -> Dict
```

---

### 2. Ingest API è·¯ç”±

**æ–‡ä»¶**: `app/api/routes_ingest.py`

**ç«¯ç‚¹**:
- `POST /api/ingest/` - å®Œæ•´ Ingest æµç¨‹
- `POST /api/ingest/upload` - ä¸Šä¼ è§†é¢‘
- `POST /api/ingest/extract-audio` - æå–éŸ³é¢‘
- `POST /api/ingest/scene-detection-info` - è·å–åœºæ™¯æ£€æµ‹æŒ‡å¼•
- `POST /api/ingest/upload-edl` - ä¸Šä¼  EDL/XML
- `GET /api/ingest/job/{job_id}` - è·å– job çŠ¶æ€

---

### 3. é›†æˆåˆ° quick_start.py

**æ›´æ–°**: `quick_start.py`

**æ–°å¢æµç¨‹**:
```
0ï¸âƒ£  Ingest - ç´ æé¢„å¤„ç†
   â”œâ”€â”€ åˆ›å»º job ç›®å½•
   â”œâ”€â”€ æå–éŸ³é¢‘
   â”œâ”€â”€ åœºæ™¯åˆ‡ç‚¹æ£€æµ‹æç¤º
   â””â”€â”€ ç­‰å¾… EDL æ–‡ä»¶

1ï¸âƒ£  åˆ†æç´ æ
2ï¸âƒ£  AI ç”Ÿæˆ
3ï¸âƒ£  Resolve æ‰§è¡Œ
```

---

### 4. æµ‹è¯•è„šæœ¬

**æ–‡ä»¶**: `test_ingest.py`

**æµ‹è¯•å†…å®¹**:
- âœ… Job ç›®å½•åˆ›å»º
- âœ… éŸ³é¢‘æå–
- âœ… åœºæ™¯åˆ‡ç‚¹æ£€æµ‹æç¤º
- âœ… å®Œæ•´ Ingest æµç¨‹

---

### 5. å®Œæ•´æ–‡æ¡£

**æ–‡ä»¶**: `INGEST_GUIDE.md`

**å†…å®¹**:
- ğŸ“– Ingest å±‚ä»‹ç»
- ğŸ“ Job ç›®å½•ç»“æ„
- ğŸš€ 4 ç§ä½¿ç”¨æ–¹å¼
- ğŸ¬ åœºæ™¯åˆ‡ç‚¹æ£€æµ‹æ­¥éª¤
- ğŸ”§ é…ç½®é€‰é¡¹
- ğŸ“Š å®Œæ•´æµç¨‹å›¾
- ğŸ§ª æµ‹è¯•æŒ‡å—
- ğŸ› æ•…éšœæ’æŸ¥

---

## ğŸ“ Job ç›®å½•ç»“æ„

```
jobs/
â””â”€â”€ job_20250205_143022/          # Job ç›®å½•
    â”œâ”€â”€ input/                     # è¾“å…¥æ–‡ä»¶
    â”‚   â”œâ”€â”€ video.mp4             # åŸå§‹è§†é¢‘
    â”‚   â””â”€â”€ timeline.edl          # EDL æ–‡ä»¶ï¼ˆç”¨æˆ·å¯¼å‡ºï¼‰
    â”œâ”€â”€ temp/                      # ä¸´æ—¶æ–‡ä»¶
    â”‚   â””â”€â”€ video.wav             # æå–çš„éŸ³é¢‘
    â””â”€â”€ output/                    # è¾“å‡ºæ–‡ä»¶
        â”œâ”€â”€ scenes.json           # åœºæ™¯æ•°æ®
        â”œâ”€â”€ transcript.json       # è½¬å½•æ•°æ®
        â”œâ”€â”€ editing_dsl.json      # å‰ªè¾‘è„šæœ¬
        â”œâ”€â”€ trace.json            # æ‰§è¡Œæ—¥å¿—
        â””â”€â”€ final.mp4             # æœ€ç»ˆæˆç‰‡
```

---

## ğŸ”„ å®Œæ•´é—­ç¯

### ä¹‹å‰çš„æµç¨‹

```
ç´ æè§†é¢‘ 
  â†’ (æœ¬åœ°) åœºæ™¯åˆ‡ç‚¹ + ASR 
  â†’ (è¿œç¨‹) ç”Ÿæˆ DSL 
  â†’ (æœ¬åœ°) Resolve è‡ªåŠ¨å‰ªè¾‘ 
  â†’ å¯¼å‡ºæˆç‰‡
```

### ç°åœ¨çš„æµç¨‹

```
ç´ æè§†é¢‘ (input.mp4)
  â†“
(æœ¬åœ°) Ingest é¢„å¤„ç†
  â”œâ”€â”€ æå–éŸ³é¢‘ (ffmpeg)
  â”œâ”€â”€ åœºæ™¯åˆ‡ç‚¹æ£€æµ‹æç¤º
  â””â”€â”€ ç­‰å¾… EDL å¯¼å‡º
  â†“
(æœ¬åœ°) åœºæ™¯åˆ‡ç‚¹ + ASR
  â”œâ”€â”€ EDL â†’ scenes.json
  â””â”€â”€ Audio â†’ transcript.json
  â†“
(è¿œç¨‹) AI ç”Ÿæˆ DSL
  â””â”€â”€ GPT-4o â†’ editing_dsl.json
  â†“
(æœ¬åœ°) Resolve è‡ªåŠ¨å‰ªè¾‘
  â””â”€â”€ DSL â†’ Actions â†’ æˆç‰‡
  â†“
æˆç‰‡ (output/final.mp4)
```

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### æ–¹å¼ 1: quick_start.pyï¼ˆæ¨èï¼‰

```bash
cd autocut-director
python quick_start.py
```

**æµç¨‹**:
1. è¾“å…¥è§†é¢‘è·¯å¾„
2. è‡ªåŠ¨åˆ›å»º job ç›®å½•
3. è‡ªåŠ¨æå–éŸ³é¢‘
4. æ˜¾ç¤ºåœºæ™¯åˆ‡ç‚¹æ£€æµ‹æŒ‡å¼•
5. ç­‰å¾…ç”¨æˆ·å¯¼å‡º EDL
6. ç»§ç»­æ‰§è¡Œå®Œæ•´æµæ°´çº¿

---

### æ–¹å¼ 2: API æ¥å£

```bash
# å®Œæ•´ Ingest
curl -X POST http://localhost:8000/api/ingest/ \
  -F "video=@input.mp4" \
  -F "extract_audio=true"

# è¿”å› job_id å’Œæ–‡ä»¶è·¯å¾„
```

---

### æ–¹å¼ 3: Python API

```python
from app.tools.media_ingest import MediaIngest

ingest = MediaIngest(job_dir="jobs")

result = ingest.ingest_video(
    video_path="input.mp4",
    job_id="job_001",
    extract_audio=True
)

print(f"Job ç›®å½•: {result['job_path']}")
print(f"éŸ³é¢‘æ–‡ä»¶: {result['audio_path']}")
```

---

## ğŸ“Š æ–‡ä»¶æ›´æ–°æ¸…å•

### æ–°å¢æ–‡ä»¶
- âœ… `app/tools/media_ingest.py` - Ingest å·¥å…·
- âœ… `app/api/routes_ingest.py` - Ingest API è·¯ç”±
- âœ… `test_ingest.py` - Ingest æµ‹è¯•
- âœ… `INGEST_GUIDE.md` - Ingest ä½¿ç”¨æŒ‡å—
- âœ… `INGEST_UPDATE.md` - æœ¬æ–‡ä»¶

### æ›´æ–°æ–‡ä»¶
- âœ… `quick_start.py` - é›†æˆ Ingest å±‚
- âœ… `app/main.py` - æ³¨å†Œ Ingest è·¯ç”±
- âœ… `CORE_LOGIC.md` - æ›´æ–°æµç¨‹å›¾
- âœ… `README.md` - æ›´æ–°æ ¸å¿ƒå·¥ä½œæµ

---

## ğŸ”§ ä¾èµ–è¦æ±‚

### ffmpeg

**ç”¨é€”**: ä»è§†é¢‘æå–éŸ³é¢‘

**å®‰è£…**:
```bash
# Windows
choco install ffmpeg

# æˆ–æ‰‹åŠ¨ä¸‹è½½
# https://ffmpeg.org/download.html
```

**éªŒè¯**:
```bash
ffmpeg -version
```

---

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

### 1. å®Œæ•´é—­ç¯
- âœ… ä»ç´ æåˆ°æˆç‰‡çš„å®Œæ•´æµç¨‹
- âœ… æ— éœ€æ‰‹åŠ¨æå–éŸ³é¢‘
- âœ… ç»Ÿä¸€çš„ job ç›®å½•ç®¡ç†

### 2. ç”¨æˆ·å‹å¥½
- âœ… æ¸…æ™°çš„åœºæ™¯åˆ‡ç‚¹æ£€æµ‹æŒ‡å¼•
- âœ… è‡ªåŠ¨ç­‰å¾… EDL æ–‡ä»¶
- âœ… äº¤äº’å¼æ“ä½œæç¤º

### 3. æ–‡ä»¶ç®¡ç†
- âœ… æ¯ä¸ª job ç‹¬ç«‹ç›®å½•
- âœ… è¾“å…¥/ä¸´æ—¶/è¾“å‡ºåˆ†ç¦»
- âœ… å®Œæ•´çš„æ–‡ä»¶è¿½è¸ª

### 4. çµæ´»æ€§
- âœ… æ”¯æŒå‘½ä»¤è¡Œã€APIã€Python è°ƒç”¨
- âœ… å¯é€‰çš„éŸ³é¢‘æå–
- âœ… å¯é€‰çš„ EDL ç­‰å¾…

---

## ğŸ“ˆ æ€§èƒ½å½±å“

### å…¸å‹ 5 åˆ†é’Ÿè§†é¢‘

| é˜¶æ®µ | æ—¶é—´ | ä½ç½® |
|------|------|------|
| **0. Ingest** | | |
| - éŸ³é¢‘æå– | 10-30s | æœ¬åœ° |
| - åœºæ™¯æ£€æµ‹ | æ‰‹åŠ¨ | Resolve |
| **1. åˆ†æ** | | |
| - EDL è§£æ | < 1s | æœ¬åœ° |
| - Whisper (base) | 1-2min | æœ¬åœ° |
| **2. AI ç”Ÿæˆ** | 10-30s | è¿œç¨‹ |
| **3. Resolve æ‰§è¡Œ** | 2-5min | æœ¬åœ° |
| **æ€»è®¡** | **3-8min** | |

**æ³¨æ„**: åœºæ™¯åˆ‡ç‚¹æ£€æµ‹æ—¶é—´å–å†³äºç”¨æˆ·æ“ä½œé€Ÿåº¦

---

## ğŸ§ª æµ‹è¯•

```bash
cd autocut-director
python test_ingest.py
```

**æµ‹è¯•ç»“æœ**:
```
âœ… Job ç›®å½•åˆ›å»º
âœ… å­ç›®å½•ç»“æ„æ­£ç¡®
âœ… åœºæ™¯åˆ‡ç‚¹æ£€æµ‹æç¤ºç”Ÿæˆ
âœ… éŸ³é¢‘æå–æˆåŠŸï¼ˆéœ€è¦ ffmpegï¼‰
âœ… Ingest æµ‹è¯•å®Œæˆ
```

---

## ğŸ› å·²çŸ¥é—®é¢˜

### 1. ffmpeg ä¾èµ–
- **é—®é¢˜**: éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£… ffmpeg
- **è§£å†³**: åœ¨æ–‡æ¡£ä¸­æä¾›å®‰è£…æŒ‡å¼•

### 2. åœºæ™¯åˆ‡ç‚¹æ£€æµ‹
- **é—®é¢˜**: éœ€è¦ç”¨æˆ·æ‰‹åŠ¨åœ¨ Resolve ä¸­æ“ä½œ
- **é™åˆ¶**: Resolve API ä¸æ”¯æŒè‡ªåŠ¨åœºæ™¯æ£€æµ‹
- **è§£å†³**: æä¾›è¯¦ç»†çš„æ“ä½œæŒ‡å¼•

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **[INGEST_GUIDE.md](INGEST_GUIDE.md)** - Ingest å±‚å®Œæ•´æŒ‡å— â­
- **[CORE_LOGIC.md](CORE_LOGIC.md)** - æ ¸å¿ƒé€»è¾‘å¯¹é½
- **[PIPELINE_GUIDE.md](PIPELINE_GUIDE.md)** - æµæ°´çº¿ä½¿ç”¨æŒ‡å—
- **[QUICK_REFERENCE.md](QUICK_REFERENCE.md)** - å¿«é€Ÿå‚è€ƒå¡ç‰‡

---

## ğŸ‰ æ€»ç»“

Ingest å±‚çš„æ·»åŠ è®© AutoCut Director çš„æµç¨‹æ›´åŠ å®Œæ•´å’Œç”¨æˆ·å‹å¥½ï¼š

### æ ¸å¿ƒæ”¹è¿›
1. âœ… **è‡ªåŠ¨éŸ³é¢‘æå–** - æ— éœ€æ‰‹åŠ¨æ“ä½œ
2. âœ… **ç»Ÿä¸€æ–‡ä»¶ç®¡ç†** - Job ç›®å½•ç»“æ„æ¸…æ™°
3. âœ… **åœºæ™¯æ£€æµ‹æŒ‡å¼•** - è¯¦ç»†çš„æ“ä½œæ­¥éª¤
4. âœ… **å®Œæ•´é—­ç¯** - ä»ç´ æåˆ°æˆç‰‡ä¸€ç«™å¼

### ä½¿ç”¨ä½“éªŒ
- ğŸš€ **æ›´ç®€å•** - ä¸€é”®å¯åŠ¨ï¼Œè‡ªåŠ¨å¤„ç†
- ğŸ“ **æ›´æ¸…æ™°** - æ–‡ä»¶ç»„ç»‡æœ‰åº
- ğŸ¯ **æ›´å®Œæ•´** - è¦†ç›–å®Œæ•´æµç¨‹

### ç«‹å³å¼€å§‹

```bash
cd autocut-director
python quick_start.py
```

**å®Œæ•´é—­ç¯å·²å°±ç»ªï¼** ğŸ¬âœ¨

---

**ç‰ˆæœ¬**: v1.2.0  
**æ›´æ–°æ—¥æœŸ**: 2025-02-05  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
