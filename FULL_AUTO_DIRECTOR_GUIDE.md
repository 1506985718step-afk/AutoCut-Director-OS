# å…¨è‡ªåŠ¨å¯¼æ¼”æ¨¡å¼æŒ‡å—

## æ¶æ„å‡çº§ï¼šVisual Intelligence Workflow

### æ–°æµç¨‹ï¼ˆBæ¨¡å¼ - å…¨è‡ªåŠ¨å¯¼æ¼”ï¼‰

```
ç”¨æˆ·ä¸Šä¼ ä¹±åºç´ æ
  â†“
VisualAnalyzer (AI çœ¼ç›ï¼šæ‰“æ ‡ç­¾)
  â†“
VisualStoryteller (AI å¤§è„‘ï¼šæ„æ€æ•…äº‹)
  â†“
LLMDirector (AI å¯¼æ¼”ï¼šç”Ÿæˆåˆ†é•œè¡¨ DSL)
  â†“
ResolveAdapter (AI æ‰‹ï¼šæ‰§è¡Œå‰ªè¾‘ + æ™ºèƒ½åˆ†ç±»)
```

## ä¸‰å¤§æ ¸å¿ƒåŠŸèƒ½

### 1. å…¨è‡ªåŠ¨å¯¼æ¼”æ¥å£ (`/api/analyze/story`)

**åŠŸèƒ½**ï¼šæ‰”è¿›è§†é¢‘ï¼Œåå‡ºæ•…äº‹

**ä½¿ç”¨**ï¼š
```bash
curl -X POST http://localhost:8000/api/analyze/story \
  -F "video_file=@video.mp4" \
  -F "duration_target=30" \
  -F "style_preference=æƒ…æ„Ÿå™äº‹" \
  -F "platform=douyin"
```

**è¾“å‡º**ï¼š
```json
{
  "success": true,
  "job_id": "job_xxx",
  "story": {
    "theme": "æµ·è¾¹åº¦å‡Vlog",
    "logic": "æŒ‰æ—¶é—´é¡ºåºï¼Œä»å‡ºå‘åˆ°æ—¥è½",
    "narrative_style": "èˆ’ç¼“æ²»æ„ˆ",
    "suggested_bgm_mood": "chill_hop"
  },
  "dsl_summary": {
    "timeline_items": 8,
    "platform": "douyin",
    "resolution": "1080x1920"
  },
  "paths": {
    "scenes": "jobs/job_xxx/scenes_with_visual.json",
    "story": "jobs/job_xxx/story_result.json",
    "dsl": "jobs/job_xxx/editing_dsl.json"
  }
}
```

**æµç¨‹**ï¼š
1. âœ… è§†é¢‘ä¸Šä¼  â†’ åœºæ™¯æ£€æµ‹
2. âœ… VisualAnalyzer â†’ æ‰“æ ‡ç­¾ï¼ˆæ™¯åˆ«ã€ä¸»ä½“ã€æƒ…ç»ªï¼‰
3. âœ… VisualStoryteller â†’ æ„æ€æ•…äº‹ï¼ˆèšç±»ã€åˆ›æ„ã€ç¼–å‰§ï¼‰
4. âœ… LLMDirector â†’ ç”Ÿæˆ DSLï¼ˆåˆ†é•œè¡¨ï¼‰
5. âœ… è¿”å›å®Œæ•´å‰ªè¾‘æ–¹æ¡ˆ

### 2. OS è¿›ç¨‹ç®¡ç†å™¨ (`app/tools/process_manager.py`)

**åŠŸèƒ½**ï¼šèµ‹äºˆ AI "ç”Ÿå‘½æƒ"

**æ ¸å¿ƒèƒ½åŠ›**ï¼š
- âœ… æ£€æµ‹ DaVinci Resolve æ˜¯å¦è¿è¡Œ
- âœ… è‡ªåŠ¨å¯åŠ¨ Resolve
- âœ… ç›‘æ§è¿›ç¨‹çŠ¶æ€ï¼ˆCPUã€å†…å­˜ã€è¿è¡Œæ—¶é—´ï¼‰
- âœ… ä¼˜é›…å…³é—­è¿›ç¨‹
- âœ… ç³»ç»Ÿèµ„æºç›‘æ§

**ä½¿ç”¨**ï¼š
```python
from app.tools.process_manager import get_process_manager

manager = get_process_manager()

# æ£€æŸ¥çŠ¶æ€
status = manager.get_resolve_status()
print(f"è¿è¡ŒçŠ¶æ€: {status['running']}")
print(f"å†…å­˜ä½¿ç”¨: {status['memory_mb']} MB")

# ç¡®ä¿è¿è¡Œï¼ˆè‡ªåŠ¨å¯åŠ¨ï¼‰
manager.ensure_resolve_running(auto_start=True)

# ç³»ç»Ÿèµ„æº
resources = manager.get_system_resources()
print(f"CPU: {resources['cpu_percent']}%")
print(f"å†…å­˜: {resources['memory_percent']}%")
```

**ä¾¿æ·å‡½æ•°**ï¼š
```python
from app.tools.process_manager import ensure_resolve_running, get_resolve_status

# ç¡®ä¿ Resolve è¿è¡Œ
if ensure_resolve_running():
    print("âœ“ Resolve å·²å°±ç»ª")

# è·å–çŠ¶æ€
status = get_resolve_status()
```

### 3. Resolve Smart Bin

**åŠŸèƒ½**ï¼šAI è‡ªåŠ¨å½’ç±»ç´ æ

**æ ¸å¿ƒèƒ½åŠ›**ï¼š
- âœ… æ ¹æ®è§†è§‰åˆ†æè‡ªåŠ¨åˆ›å»º Bins
- âœ… æŒ‰å†…å®¹åˆ†ç±»ï¼ˆäººç‰©ã€é£æ™¯ã€ç‰©å“ï¼‰
- âœ… æŒ‰æ™¯åˆ«åˆ†ç±»ï¼ˆç‰¹å†™ã€ä¸­æ™¯ã€å…¨æ™¯ï¼‰
- âœ… æŒ‰æƒ…ç»ªåˆ†ç±»ï¼ˆå¼€å¿ƒã€å¹³é™ã€ç´§å¼ ï¼‰
- âœ… æŒ‰è´¨é‡åˆ†ç±»ï¼ˆé«˜è´¨é‡ã€ä¸­ç­‰ã€ä½è´¨é‡ï¼‰
- âœ… è®¾ç½®å…ƒæ•°æ®æ ‡è®°

**ä½¿ç”¨**ï¼š
```python
from app.executor.resolve_adapter import ResolveAdapter
from app.models.schemas import ScenesJSON

# è¿æ¥ Resolve
adapter = ResolveAdapter()
adapter.connect()

# åˆ›å»ºæ™ºèƒ½ Bins
result = adapter.create_smart_bins(scenes_data)

# è¾“å‡ºï¼š
# ğŸ“ åˆ›å»ºæ™ºèƒ½ Bins...
#   âœ“ äººç‰©: 3 ä¸ªé•œå¤´
#   âœ“ é£æ™¯: 5 ä¸ªé•œå¤´
#   âœ“ ç‰¹å†™: 4 ä¸ªé•œå¤´
#   âœ“ ä¸­æ™¯: 6 ä¸ªé•œå¤´
#   âœ“ å¼€å¿ƒ: 3 ä¸ªé•œå¤´
#   âœ“ é«˜è´¨é‡(8-10): 7 ä¸ªé•œå¤´
```

**Bin ç»“æ„**ï¼š
```
Media Pool
â””â”€â”€ AutoCut_æ™ºèƒ½åˆ†ç±»
    â”œâ”€â”€ æŒ‰å†…å®¹åˆ†ç±»
    â”‚   â”œâ”€â”€ äººç‰©
    â”‚   â”œâ”€â”€ é£æ™¯
    â”‚   â””â”€â”€ ç‰©å“
    â”œâ”€â”€ æŒ‰æ™¯åˆ«åˆ†ç±»
    â”‚   â”œâ”€â”€ ç‰¹å†™
    â”‚   â”œâ”€â”€ è¿‘æ™¯
    â”‚   â”œâ”€â”€ ä¸­æ™¯
    â”‚   â”œâ”€â”€ å…¨æ™¯
    â”‚   â””â”€â”€ è¿œæ™¯
    â”œâ”€â”€ æŒ‰æƒ…ç»ªåˆ†ç±»
    â”‚   â”œâ”€â”€ å¼€å¿ƒ
    â”‚   â”œâ”€â”€ å¹³é™
    â”‚   â””â”€â”€ ç´§å¼ 
    â””â”€â”€ æŒ‰è´¨é‡åˆ†ç±»
        â”œâ”€â”€ é«˜è´¨é‡(8-10)
        â”œâ”€â”€ ä¸­ç­‰(5-7)
        â””â”€â”€ ä½è´¨é‡(1-4)
```

## å®Œæ•´å·¥ä½œæµç¤ºä¾‹

### åœºæ™¯ 1ï¼šé›¶æ•£æ—…è¡Œç´ æ

```bash
# 1. ä¸Šä¼ è§†é¢‘ï¼Œå…¨è‡ªåŠ¨åˆ†æ
curl -X POST http://localhost:8000/api/analyze/story \
  -F "video_file=@travel.mp4" \
  -F "duration_target=60" \
  -F "style_preference=æƒ…æ„Ÿå™äº‹"

# 2. è·å–ç»“æœ
# job_id: job_20260205_150000
# ä¸»é¢˜: æµ·è¾¹åº¦å‡Vlog
# é£æ ¼: èˆ’ç¼“æ²»æ„ˆ
# æ—¶é—´çº¿: 8 ä¸ªç‰‡æ®µ

# 3. åœ¨ Resolve ä¸­æŸ¥çœ‹
# - Media Pool ä¸­è‡ªåŠ¨åˆ›å»ºäº†æ™ºèƒ½åˆ†ç±»
# - ç´ æå·²æŒ‰å†…å®¹ã€æ™¯åˆ«ã€æƒ…ç»ªå½’ç±»
# - å¯ä»¥ç›´æ¥ä½¿ç”¨åˆ†ç±»å¥½çš„ç´ æ
```

### åœºæ™¯ 2ï¼šäº§å“æ‹æ‘„ç´ æ

```bash
# 1. ä¸Šä¼ è§†é¢‘
curl -X POST http://localhost:8000/api/analyze/story \
  -F "video_file=@product.mp4" \
  -F "duration_target=30" \
  -F "style_preference=é«˜ç‡ƒè¸©ç‚¹ï¼Œäº§å“å±•ç¤º"

# 2. AI è‡ªåŠ¨è¯†åˆ«
# - äº§å“ç‰¹å†™é•œå¤´
# - ä½¿ç”¨åœºæ™¯é•œå¤´
# - ç»†èŠ‚å±•ç¤ºé•œå¤´

# 3. ç”Ÿæˆå‰ªè¾‘æ–¹æ¡ˆ
# - å¿«èŠ‚å¥è¸©ç‚¹
# - äº§å“ä»‹ç»æ–‡æ¡ˆ
# - é«˜è´¨é‡é•œå¤´ä¼˜å…ˆ
```

### åœºæ™¯ 3ï¼šç¾é£Ÿæ‹æ‘„ç´ æ

```bash
# 1. ä¸Šä¼ è§†é¢‘
curl -X POST http://localhost:8000/api/analyze/story \
  -F "video_file=@food.mp4" \
  -F "duration_target=45" \
  -F "style_preference=æ°›å›´æ„Ÿï¼Œç¾é£Ÿæ¢åº—"

# 2. AI è‡ªåŠ¨è¯†åˆ«
# - é£Ÿç‰©ç‰¹å†™
# - ç¯å¢ƒæ°›å›´
# - äººç‰©äº’åŠ¨

# 3. ç”Ÿæˆå‰ªè¾‘æ–¹æ¡ˆ
# - æ…¢èŠ‚å¥æ°›å›´æ„Ÿ
# - è¯±äººçš„ç¾é£Ÿæ–‡æ¡ˆ
# - æƒ…ç»ªæ¸²æŸ“
```

## æŠ€æœ¯æ¶æ„

### æ•°æ®æµ

```
video.mp4
  â†“
åœºæ™¯æ£€æµ‹ï¼ˆFFprobe + ç®€å•åˆ†æ®µï¼‰
  â†“
scenes.json
  â†“
VisualAnalyzerï¼ˆGPT-4o Visionï¼‰
  â†“
scenes_with_visual.json
  â†“
VisualStorytellerï¼ˆGPT-4oï¼‰
  â†“
story_result.json + transcript_generated.json
  â†“
LLMDirectorï¼ˆGPT-4oï¼‰
  â†“
editing_dsl.json
  â†“
ResolveAdapterï¼ˆSmart Binsï¼‰
  â†“
Media Pool æ™ºèƒ½åˆ†ç±»
```

### API è°ƒç”¨é“¾

```
POST /api/analyze/story
  â†“
1. åœºæ™¯æ£€æµ‹ï¼ˆæœ¬åœ°ï¼‰
2. VisualAnalyzer.analyze_scene_visuals()
   - API è°ƒç”¨ï¼šN æ¬¡ï¼ˆN = åœºæ™¯æ•°ï¼‰
3. VisualStoryteller.generate_story_from_visuals()
   - API è°ƒç”¨ï¼š2 æ¬¡ï¼ˆæ„æ€ + ç¼–å‰§ï¼‰
4. LLMDirector.generate_editing_dsl()
   - API è°ƒç”¨ï¼š1 æ¬¡
5. ResolveAdapter.create_smart_bins()
   - æœ¬åœ°æ“ä½œ
  â†“
è¿”å›å®Œæ•´ç»“æœ
```

### æˆæœ¬ä¼°ç®—

- åœºæ™¯æ£€æµ‹ï¼šå…è´¹ï¼ˆæœ¬åœ°ï¼‰
- è§†è§‰åˆ†æï¼š~$0.001 Ã— Nï¼ˆN = åœºæ™¯æ•°ï¼‰
- æ•…äº‹æ„æ€ï¼š~$0.02-0.05
- DSL ç”Ÿæˆï¼š~$0.03-0.08
- Smart Binsï¼šå…è´¹ï¼ˆæœ¬åœ°ï¼‰

**æ€»è®¡**ï¼š~$0.05-0.15 per videoï¼ˆ10 ä¸ªåœºæ™¯ï¼‰

### æ€§èƒ½æŒ‡æ ‡

- åœºæ™¯æ£€æµ‹ï¼š< 5 ç§’
- è§†è§‰åˆ†æï¼š~2-3 ç§’ Ã— N
- æ•…äº‹æ„æ€ï¼š~5-10 ç§’
- DSL ç”Ÿæˆï¼š~5-10 ç§’
- Smart Binsï¼š< 5 ç§’

**æ€»è®¡**ï¼š~30-60 ç§’ï¼ˆ10 ä¸ªåœºæ™¯ï¼‰

## é…ç½®

### ç¯å¢ƒå˜é‡

```bash
# .env
OPENAI_API_KEY=sk-your-api-key-here
OPENAI_MODEL=gpt-4o
```

### ä¾èµ–

```bash
pip install psutil  # è¿›ç¨‹ç®¡ç†
```

### Resolve è®¾ç½®

1. å¯åŠ¨ DaVinci Resolve
2. æ‰“å¼€ä¸€ä¸ªé¡¹ç›®
3. ç¡®ä¿å¤–éƒ¨è„šæœ¬å·²å¯ç”¨

## æµ‹è¯•

### è¿è¡Œæµ‹è¯•å¥—ä»¶

```bash
cd autocut-director
python test_full_auto_director.py
```

æµ‹è¯•å†…å®¹ï¼š
1. âœ… OS è¿›ç¨‹ç®¡ç†å™¨
2. âœ… Resolve Smart Bins
3. âœ… å…¨è‡ªåŠ¨å·¥ä½œæµï¼ˆæ¼”ç¤ºï¼‰

### é¢„æœŸè¾“å‡º

```
ğŸ¬ å…¨è‡ªåŠ¨å¯¼æ¼”æ¨¡å¼å¯åŠ¨...
  âœ“ è§†é¢‘å·²ä¿å­˜

[1/5] åœºæ™¯æ£€æµ‹...
  âœ“ æ£€æµ‹åˆ° 10 ä¸ªåœºæ™¯

[2/5] è§†è§‰åˆ†æï¼ˆAI çœ¼ç›ï¼‰...
  > åˆ†æ S0001 (T=2.5s)... âœ… [ä¸­æ™¯] å¹´è½»äººåœ¨å’–å•¡å…
  > åˆ†æ S0002 (T=7.5s)... âœ… [ç‰¹å†™] å’–å•¡æ¯ç‰¹å†™
  ...
  âœ… è§†è§‰åˆ†æå®Œæˆ: 10/10 ä¸ªåœºæ™¯

[3/5] æ•…äº‹æ„æ€ï¼ˆAI å¤§è„‘ï¼‰...
  âœ“ ä¸»é¢˜: å’–å•¡é¦†çš„åˆåæ—¶å…‰
  âœ“ é£æ ¼: èˆ’ç¼“æ²»æ„ˆ

[4/5] ç”Ÿæˆå‰ªè¾‘æ–¹æ¡ˆï¼ˆAI å¯¼æ¼”ï¼‰...
  âœ“ æ—¶é—´çº¿ç‰‡æ®µ: 8

[5/5] å®Œæˆï¼
  âœ“ ä¸»é¢˜: å’–å•¡é¦†çš„åˆåæ—¶å…‰
  âœ“ é£æ ¼: èˆ’ç¼“æ²»æ„ˆ
  âœ“ æ—¶é—´çº¿ç‰‡æ®µ: 8

âœ… å…¨è‡ªåŠ¨åˆ†æå®Œæˆ
```

## æ•…éšœæ’é™¤

### Q1: æç¤º "Cannot connect to DaVinci Resolve"

**è§£å†³**ï¼š
```python
from app.tools.process_manager import ensure_resolve_running

# è‡ªåŠ¨å¯åŠ¨ Resolve
ensure_resolve_running(auto_start=True)
```

### Q2: Smart Bins åˆ›å»ºå¤±è´¥

**åŸå› **ï¼šResolve API ç‰ˆæœ¬ä¸å…¼å®¹

**è§£å†³**ï¼š
1. ç¡®ä¿ä½¿ç”¨ Resolve Studio ç‰ˆæœ¬
2. æ£€æŸ¥ API ç‰ˆæœ¬
3. æ‰‹åŠ¨åˆ›å»º Bins ä½œä¸ºå¤‡é€‰

### Q3: åœºæ™¯æ£€æµ‹ä¸å‡†ç¡®

**åŸå› **ï¼šä½¿ç”¨ç®€å•åˆ†æ®µç®—æ³•

**è§£å†³**ï¼š
1. é›†æˆçœŸæ­£çš„åœºæ™¯æ£€æµ‹ç®—æ³•
2. ä½¿ç”¨ PySceneDetect
3. æˆ–ä½¿ç”¨ Resolve çš„åœºæ™¯æ£€æµ‹åŠŸèƒ½

### Q4: æˆæœ¬è¿‡é«˜

**ä¼˜åŒ–**ï¼š
1. é™åˆ¶è§†è§‰åˆ†æçš„åœºæ™¯æ•°é‡
2. ä½¿ç”¨ `max_scenes` å‚æ•°
3. åªåˆ†æå…³é”®åœºæ™¯

## æœ€ä½³å®è·µ

### 1. ç´ æå‡†å¤‡

- âœ… è§†é¢‘æ—¶é•¿ï¼š30-120 ç§’
- âœ… åˆ†è¾¨ç‡ï¼š1080p æˆ–ä»¥ä¸Š
- âœ… æ ¼å¼ï¼šMP4ã€MOV

### 2. å‚æ•°è®¾ç½®

- âœ… `duration_target`ï¼šæ ¹æ®å¹³å°é€‰æ‹©ï¼ˆæŠ–éŸ³ 15-30sï¼ŒBç«™ 60-120sï¼‰
- âœ… `style_preference`ï¼šæ˜ç¡®é£æ ¼åå¥½
- âœ… `platform`ï¼šé€‰æ‹©ç›®æ ‡å¹³å°

### 3. æˆæœ¬æ§åˆ¶

- âœ… ä½¿ç”¨ `max_scenes` é™åˆ¶åˆ†ææ•°é‡
- âœ… æ‰¹é‡å¤„ç†å¤šä¸ªè§†é¢‘
- âœ… ç¼“å­˜è§†è§‰åˆ†æç»“æœ

### 4. ç»“æœä¼˜åŒ–

- âœ… æŸ¥çœ‹å¤‡é€‰ä¸»é¢˜
- âœ… æ‰‹åŠ¨å¾®è°ƒ DSL
- âœ… åˆ©ç”¨ Smart Bins å¿«é€Ÿå®šä½ç´ æ

## æœªæ¥è®¡åˆ’

- [ ] çœŸæ­£çš„åœºæ™¯æ£€æµ‹ç®—æ³•
- [ ] æ”¯æŒæ‰¹é‡è§†é¢‘å¤„ç†
- [ ] æ”¯æŒå®æ—¶é¢„è§ˆ
- [ ] æ”¯æŒç”¨æˆ·åé¦ˆå­¦ä¹ 
- [ ] æ”¯æŒæ›´å¤šå¹³å°
- [ ] æ”¯æŒè‡ªå®šä¹‰åˆ†ç±»è§„åˆ™
- [ ] æ”¯æŒç´ ææ¨è

## æ€»ç»“

å…¨è‡ªåŠ¨å¯¼æ¼”æ¨¡å¼æ˜¯ AutoCut Director çš„ç»ˆæå½¢æ€ï¼š

- âœ… æ‰”è¿›è§†é¢‘ï¼Œåå‡ºæ•…äº‹
- âœ… AI çœ¼ç›ï¼ˆè§†è§‰åˆ†æï¼‰
- âœ… AI å¤§è„‘ï¼ˆæ•…äº‹æ„æ€ï¼‰
- âœ… AI å¯¼æ¼”ï¼ˆDSL ç”Ÿæˆï¼‰
- âœ… AI æ‰‹ï¼ˆæ™ºèƒ½åˆ†ç±»ï¼‰

**æ ¸å¿ƒä»·å€¼**ï¼š
- é›¶é—¨æ§›åˆ›ä½œ
- å…¨è‡ªåŠ¨åŒ–æµç¨‹
- æ™ºèƒ½ç´ æç®¡ç†
- å¿«é€ŸåŸå‹åˆ¶ä½œ

**æŠ€æœ¯äº®ç‚¹**ï¼š
- å®Œæ•´çš„ AI å·¥ä½œæµ
- è¿›ç¨‹çº§åˆ«çš„æ§åˆ¶
- æ™ºèƒ½çš„ç´ æå½’ç±»
- å³ä½¿ä¸å‰ªè¾‘ä¹Ÿæœ‰ä»·å€¼

---

**ç‰ˆæœ¬**: v2.0.0  
**æ—¥æœŸ**: 2026-02-05  
**çŠ¶æ€**: âœ… å…¨è‡ªåŠ¨å¯¼æ¼”æ¨¡å¼å·²å®ç°
